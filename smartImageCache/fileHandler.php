<?php
/**
 * This module is intended to show a cache size with its own handler and buttons.
 * Passing 'retry' will purge the designated cache before regenerating cache images
 * @package plugins
 * @subpackage smartImageCache
 */

/* ---------------------------------------------------------------------------------------------------------------------------------------------------- */
/* Includes																																				*/
/* ---------------------------------------------------------------------------------------------------------------------------------------------------- */
require_once('function.php');
/* ---------------------------------------------------------------------------------------------------------------------------------------------------- */
/* Definition																																			*/
/* ---------------------------------------------------------------------------------------------------------------------------------------------------- */
define('OFFSET_PATH',3);
define('CR_LF',chr(13).chr(10));
$html ='';
/* ---------------------------------------------------------------------------------------------------------------------------------------------------- */
/* Parameters																																			*/
/* ---------------------------------------------------------------------------------------------------------------------------------------------------- */
$id=(isset($_REQUEST['id'])?urldecode($_REQUEST['id']):0);
$key=(isset($_REQUEST['key'])?urldecode($_REQUEST['key']):null);
$cache=(isset($_REQUEST['cache'])?urldecode($_REQUEST['cache']):null);
$enable=(isset($_REQUEST['enable'])?urldecode($_REQUEST['enable']):null);
/* ---------------------------------------------------------------------------------------------------------------------------------------------------- */
/* Controls																																				*/
/* ---------------------------------------------------------------------------------------------------------------------------------------------------- */
/*
echo '<pre>'.CR_LF;
print_r('$id: '.$id.CR_LF);
print_r('$key: '.$key.CR_LF);
print_r('$cache: '.$cache.CR_LF);
print_r('$enable: '.$enable.CR_LF);
print_r('getToken: '.getToken('picID'.$id.'-'.$key).CR_LF);
print_r('---------------------'.CR_LF);
echo '</pre>'.CR_LF;
*/
/* ---------------------------------------------------------------------------------------------------------------------------------------------------- */
/* Display																																				*/
/* ---------------------------------------------------------------------------------------------------------------------------------------------------- */
header("Cache-Control:no-cache,no-store,must-revalidate");
header("Pragma:no-cache");
header("Expires:0");

echo '<html>'.CR_LF;
echo '<head>'.CR_LF;
echo '<meta http-equiv="Cache-Control" content="no-cache,no-store,must-revalidate"/>'.CR_LF;
echo '<meta http-equiv="Pragma" content="no-cache"/>'.CR_LF;
echo '<meta http-equiv="Expires" content="0"/>'.CR_LF;
echo '</head>'.CR_LF;
echo '<body onload="setTimeout(function() {this.close()},1000);">'.CR_LF;
/* ---------------------------------------------------------------------------------------------------------------------------------------------------- */
/* Delete file																																			*/
/* ---------------------------------------------------------------------------------------------------------------------------------------------------- */
if (checkToken($enable,'picID'.$id.'-'.$key)) {
	if (file_exists($cache)) {
		if (unlink($cache)) {
			echo gettext('File').' <em>'.$cache.'</em><br><b>'.gettext('successfully deleted!').'</b>'.CR_LF;
		} else {
			echo '<b>'.gettext('Something went wrong').'</b><br> '.gettext('with file').' <em>'.$cache.'</em>'.CR_LF;
		}
	} else {
		echo gettext('File').' <em>'.$cache.'</em><br><b>'.gettext('not found!').'</b>'.CR_LF;
	}
} else {
	echo '<b>'.gettext('You are NOT allowed to use this function!!!').'</b>'.CR_LF;
}
/* ---------------------------------------------------------------------------------------------------------------------------------------------------- */
/* Script																																				*/
/* ---------------------------------------------------------------------------------------------------------------------------------------------------- */
echo '</body>'.CR_LF;
echo '</html>'.CR_LF;
/* ---------------------------------------------------------------------------------------------------------------------------------------------------- */
/* ---------------------------------------------------------------------------------------------------------------------------------------------------- */
/* ---------------------------------------------------------------------------------------------------------------------------------------------------- */
?>